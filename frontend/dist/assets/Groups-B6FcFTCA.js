import{_ as Z,u as ee,j as te,o as i,c as r,a as s,b as t,w as o,t as p,e as $,r as a,f as _,g as oe,h as u,F as E,n as L,d as H,p as b,k as le,m as J,i as se}from"./index-D_A4Kxuy.js";import{u as ne}from"./user-Cr4O6Dv3.js";const ae={class:"groups-container"},de={class:"groups-header"},ie={class:"groups-content"},re={class:"my-groups"},ue={key:0},ce={key:0,class:"created-groups"},pe={class:"group-name"},_e={class:"group-description"},me={class:"group-members"},fe={class:"group-actions"},ke={key:1,class:"joined-groups"},ge={class:"group-name"},ve={class:"group-description"},he={class:"group-members"},ye={class:"group-joined"},be={class:"group-actions"},Ce={key:1,class:"no-groups"},Ve={key:0,class:"group-checkins"},we={class:"card-title"},xe={key:0},Ge={key:1,class:"no-checkins"},$e={class:"dialog-footer"},je={__name:"Groups",setup(qe){const C=ee(),V=ne(),j=oe(),f=_(!1),w=_(null),x=_(null),K=_(""),q=_("checked_in"),G=_(new Date),k=_({checked_in:[],not_checked_in:[]}),d=se({name:"",description:"",daily_checkin_required:!0}),O={name:[{required:!0,message:"请输入群组名称",trigger:"blur"},{min:2,max:100,message:"长度在 2 到 100 个字符",trigger:"blur"}]},m=le(()=>V.groups||{created:[],joined:[]}),U=()=>{f.value=!0},D=n=>{j.push(`/groups/${n}`)},P=async()=>{if(w.value)try{await w.value.validate();const n={name:d.name,description:d.description,daily_checkin_required:d.daily_checkin_required};await J.groups.createGroup(n),await V.fetchGroups(),f.value=!1,d.name="",d.description="",d.daily_checkin_required=!0}catch(n){console.error("创建群组失败:",n)}},F=n=>{console.log("查看群组成员:",n)},N=(n,e)=>{j.push({path:`/groups/${n}/chat`,query:{name:e}})},S=async()=>{if(x.value)try{const n=await J.groups.getGroupCheckins(x.value,{date:G.value});k.value={checked_in:n.data.data.checked_in||[],not_checked_in:n.data.data.not_checked_in||[]}}catch(n){console.error("获取群组打卡情况失败:",n)}};return te(async()=>{C.isAuthenticated&&!C.user&&await C.fetchUserInfo(),await V.fetchGroups()}),(n,e)=>{const c=a("el-button"),h=a("el-card"),z=a("el-grid-item"),B=a("el-grid"),R=a("el-empty"),Q=a("el-date-picker"),g=a("el-form-item"),I=a("el-form"),y=a("el-table-column"),M=a("el-table"),T=a("el-tab-pane"),W=a("el-tabs"),A=a("el-input"),X=a("el-checkbox"),Y=a("el-dialog");return i(),r("div",ae,[e[20]||(e[20]=s("h1",{class:"page-title"},"学习群组",-1)),s("div",de,[t(c,{type:"primary",onClick:U,class:"create-group-btn"},{default:o(()=>[...e[7]||(e[7]=[u(" 创建群组 ",-1)])]),_:1})]),s("div",ie,[s("div",re,[e[15]||(e[15]=s("h2",{class:"card-title"},"我的群组",-1)),t(h,{"body-style":{padding:"20px"}},{default:o(()=>[m.value.created.length>0||m.value.joined.length>0?(i(),r("div",ue,[m.value.created.length>0?(i(),r("div",ce,[e[10]||(e[10]=s("h3",{class:"section-title"},"我创建的群组",-1)),t(B,{column:3,gutter:20},{default:o(()=>[(i(!0),r(E,null,L(m.value.created,l=>(i(),H(z,{key:l.group_id},{default:o(()=>[t(h,{"body-style":{padding:"15px"},class:"group-card",onClick:v=>D(l.group_id)},{default:o(()=>[s("h4",pe,p(l.name),1),s("p",_e,p(l.description||"暂无描述"),1),s("p",me,"成员: "+p(l.member_count)+" 人",1),s("div",fe,[t(c,{size:"small",onClick:b(v=>F(l.group_id),["stop"])},{default:o(()=>[...e[8]||(e[8]=[u(" 查看成员 ",-1)])]),_:1},8,["onClick"]),t(c,{size:"small",type:"primary",onClick:b(v=>N(l.group_id,l.name),["stop"])},{default:o(()=>[...e[9]||(e[9]=[u(" 查看打卡 ",-1)])]),_:1},8,["onClick"])])]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})])):$("",!0),m.value.joined.length>0?(i(),r("div",ke,[e[13]||(e[13]=s("h3",{class:"section-title"},"我加入的群组",-1)),t(B,{column:3,gutter:20},{default:o(()=>[(i(!0),r(E,null,L(m.value.joined,l=>(i(),H(z,{key:l.group_id},{default:o(()=>[t(h,{"body-style":{padding:"15px"},class:"group-card",onClick:v=>D(l.group_id)},{default:o(()=>[s("h4",ge,p(l.name),1),s("p",ve,p(l.description||"暂无描述"),1),s("p",he,"成员: "+p(l.member_count)+" 人",1),s("p",ye,"加入时间: "+p(l.joined_at),1),s("div",be,[t(c,{size:"small",onClick:b(v=>F(l.group_id),["stop"])},{default:o(()=>[...e[11]||(e[11]=[u(" 查看成员 ",-1)])]),_:1},8,["onClick"]),t(c,{size:"small",type:"primary",onClick:b(v=>N(l.group_id,l.name),["stop"])},{default:o(()=>[...e[12]||(e[12]=[u(" 查看打卡 ",-1)])]),_:1},8,["onClick"])])]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})])):$("",!0)])):(i(),r("div",Ce,[t(R,{description:"暂无群组"}),t(c,{type:"primary",onClick:U},{default:o(()=>[...e[14]||(e[14]=[u(" 创建群组 ",-1)])]),_:1})]))]),_:1})]),x.value?(i(),r("div",Ve,[s("h2",we,p(K.value)+" - 打卡情况",1),t(h,{"body-style":{padding:"20px"}},{default:o(()=>[t(I,{inline:!0,class:"date-form"},{default:o(()=>[t(g,{label:"日期"},{default:o(()=>[t(Q,{modelValue:G.value,"onUpdate:modelValue":e[0]||(e[0]=l=>G.value=l),type:"date",placeholder:"选择日期",onChange:S},null,8,["modelValue"])]),_:1}),t(g,null,{default:o(()=>[t(c,{type:"primary",onClick:S},{default:o(()=>[...e[16]||(e[16]=[u(" 查询 ",-1)])]),_:1})]),_:1})]),_:1}),k.value.checked_in.length>0||k.value.not_checked_in.length>0?(i(),r("div",xe,[t(W,{modelValue:q.value,"onUpdate:modelValue":e[1]||(e[1]=l=>q.value=l)},{default:o(()=>[t(T,{label:"已打卡",name:"checked_in"},{default:o(()=>[t(M,{data:k.value.checked_in,style:{width:"100%"}},{default:o(()=>[t(y,{prop:"username",label:"用户名",width:"150"}),t(y,{prop:"hours",label:"学习时长（小时）",width:"150"}),t(y,{prop:"checkin_time",label:"打卡时间"})]),_:1},8,["data"])]),_:1}),t(T,{label:"未打卡",name:"not_checked_in"},{default:o(()=>[t(M,{data:k.value.not_checked_in,style:{width:"100%"}},{default:o(()=>[t(y,{prop:"username",label:"用户名"})]),_:1},8,["data"])]),_:1})]),_:1},8,["modelValue"])])):(i(),r("div",Ge,[t(R,{description:"暂无打卡数据"})]))]),_:1})])):$("",!0)]),t(Y,{modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=l=>f.value=l),title:"创建学习群组",width:"500px"},{footer:o(()=>[s("span",$e,[t(c,{onClick:e[5]||(e[5]=l=>f.value=!1)},{default:o(()=>[...e[18]||(e[18]=[u(" 取消 ",-1)])]),_:1}),t(c,{type:"primary",onClick:P},{default:o(()=>[...e[19]||(e[19]=[u(" 确定 ",-1)])]),_:1})])]),default:o(()=>[t(I,{model:d,rules:O,ref_key:"groupFormRef",ref:w,"label-width":"100px"},{default:o(()=>[t(g,{label:"群组名称",prop:"name"},{default:o(()=>[t(A,{modelValue:d.name,"onUpdate:modelValue":e[2]||(e[2]=l=>d.name=l),placeholder:"请输入群组名称"},null,8,["modelValue"])]),_:1}),t(g,{label:"群组描述",prop:"description"},{default:o(()=>[t(A,{modelValue:d.description,"onUpdate:modelValue":e[3]||(e[3]=l=>d.description=l),type:"textarea",placeholder:"请输入群组描述",rows:3},null,8,["modelValue"])]),_:1}),t(g,{label:"每日打卡规则"},{default:o(()=>[t(X,{modelValue:d.daily_checkin_required,"onUpdate:modelValue":e[4]||(e[4]=l=>d.daily_checkin_required=l)},{default:o(()=>[...e[17]||(e[17]=[u(" 每天至少 1 次打卡 ",-1)])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Fe=Z(je,[["__scopeId","data-v-aeea4973"]]);export{Fe as default};

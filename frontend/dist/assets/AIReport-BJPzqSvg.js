import{_ as se,u as te,j as le,o as i,c as u,a as t,b as s,w as l,p as E,r as c,f as g,h as w,t as m,F as q,n as B,d as W,e as I}from"./index-CrPuRJEc.js";const ae={class:"ai-report-container"},oe={class:"report-card"},ne={key:0,class:"report-content"},ie={class:"score-section"},re={class:"score-card"},de={class:"total-score"},ue={class:"score-details"},ce={class:"score-item"},pe={class:"score-item"},_e={class:"score-item"},me={class:"summary-section"},ve={class:"summary-item"},ye={class:"summary-value"},ge={class:"summary-item"},fe={class:"summary-value"},he={class:"summary-item"},ke={class:"summary-value"},be={class:"issues-suggestions"},we={class:"issues-section"},Ve={key:0},Ae={key:1,class:"no-issues"},Ie={class:"suggestions-section"},Ce={key:0},Se={key:1,class:"no-suggestions"},xe={class:"recommended-section"},De={class:"recommended-hours"},Te={class:"hours-value"},Re={key:1,class:"loading-report"},Ue={class:"ai-coach-card"},Pe={class:"learning-data-form"},Le={key:0,class:"coach-response"},Ee=["innerHTML"],qe={key:1,class:"loading-coach"},Be={class:"ai-checkin-analysis-card"},Fe={class:"analysis-controls"},Ne={key:0,class:"analysis-results"},Oe={class:"stats-overview"},$e={class:"stat-value"},Me={class:"stat-value"},je={class:"stat-value"},He={class:"stat-value"},We={class:"insights-section"},ze={class:"recommendations-section"},Je={key:1,class:"anomalies-section"},Ge={class:"summary-section"},Ke={class:"ai-summary-content"},Qe={key:1,class:"loading-analysis"},Xe={__name:"AIReport",setup(Ye){const F=te(),C=g(new Date),d=g(null),S=g(""),v=g({learning_goal:"考研数学",weekly_total_hours:12,average_daily_hours:1.7,target_daily_hours:3,consecutive_checkin_days:3,missed_checkin_days:2}),N=g(null),x=g(""),O=g(!1),D=g(new Date(Date.now()-720*60*60*1e3)),T=g(new Date),$=g("comprehensive"),y=g(null),b=g(""),M=g(!1),j=async()=>{var o,e;try{S.value="";const p=C.value?new Date(C.value).toISOString().split("T")[0]:null,n=await E.ai.getWeeklyReport({week_date:p});d.value=n.data.data}catch(p){S.value=((e=(o=p.response)==null?void 0:o.data)==null?void 0:e.message)||"生成报告失败，请稍后重试",console.error("生成报告失败:",p)}},z=async()=>{try{O.value=!0,x.value="";const o=await fetch("/api/ai/learning_coach",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(v.value)});if(!o.ok)throw new Error("API请求失败");const e=o.body.getReader(),p=new TextDecoder;let n="";for(;;){const{done:h,value:f}=await e.read();if(h)break;const r=p.decode(f,{stream:!0});n+=r}let _=n.replace(/\n/g,"<br>").replace(/^- (.*?)<br>/gm,"<li>$1</li>").replace(/(<li>.*?<\/li>)/gs,"<ul>$1</ul>");N.value=_}catch(o){x.value=o.message||"获取学习指导失败，请稍后重试",console.error("获取学习指导失败:",o)}finally{O.value=!1}},J=async()=>{try{console.log("测试API连接开始...");const o=localStorage.getItem("token");console.log("Token存在:",!!o);const e=await E.users.getMe();console.log("用户API测试成功:",e);const p={start_date:"2024-01-01",end_date:"2024-01-31",analysis_type:"comprehensive"};console.log("测试打卡分析API，请求数据:",p);const n=await E.ai.getCheckinAnalysis(p);console.log("打卡分析API测试成功:",n),alert("API连接测试成功！")}catch(o){console.error("API测试失败:",o),console.error("错误详情:",o.response||o),alert(`API测试失败: ${o.message||"未知错误"}`)}},G=async()=>{var o,e,p,n;try{M.value=!0,b.value="";const _=localStorage.getItem("token");if(console.log("当前token:",_),!_){b.value="请先登录系统";return}const h=D.value?new Date(D.value).toISOString().split("T")[0]:null,f=T.value?new Date(T.value).toISOString().split("T")[0]:null,r={start_date:h,end_date:f,analysis_type:$.value};console.log("请求数据:",r);const U=await E.ai.getCheckinAnalysis(r);console.log("打卡分析响应:",U),y.value=U.data.data}catch(_){console.error("打卡分析失败详情:",_),console.error("错误响应:",_.response),console.error("错误数据:",(o=_.response)==null?void 0:o.data),((e=_.response)==null?void 0:e.status)===401?(b.value="登录已过期，请重新登录",localStorage.removeItem("token"),setTimeout(()=>{window.location.href="/auth/login"},2e3)):b.value=((n=(p=_.response)==null?void 0:p.data)==null?void 0:n.message)||_.message||"打卡分析失败，请稍后重试"}finally{M.value=!1}},R=o=>o>=80?"#67C23A":o>=60?"#E6A23C":"#F56C6C",K=o=>`${o}分`;return le(async()=>{F.isAuthenticated&&!F.user&&await F.fetchUserInfo(),j()}),(o,e)=>{const p=c("el-date-picker"),n=c("el-form-item"),_=c("el-button"),h=c("el-form"),f=c("el-progress"),r=c("el-card"),U=c("el-empty"),V=c("el-alert"),Q=c("el-input"),A=c("el-input-number"),H=c("el-option"),X=c("el-select"),P=c("el-col"),Y=c("el-row"),L=c("el-table-column"),Z=c("el-tag"),ee=c("el-table");return i(),u("div",ae,[e[38]||(e[38]=t("h1",{class:"page-title"},"AI学习评估",-1)),t("div",oe,[s(r,{"body-style":{padding:"30px"}},{default:l(()=>[e[23]||(e[23]=t("h2",{class:"card-title"},"本周学习报告",-1)),s(h,{inline:!0,class:"week-form"},{default:l(()=>[s(n,{label:"周开始日期"},{default:l(()=>[s(p,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=a=>C.value=a),type:"date",placeholder:"选择周开始日期",onChange:j},null,8,["modelValue"])]),_:1}),s(n,null,{default:l(()=>[s(_,{type:"primary",onClick:j},{default:l(()=>[...e[10]||(e[10]=[w(" 生成报告 ",-1)])]),_:1})]),_:1})]),_:1}),d.value?(i(),u("div",ne,[t("div",ie,[e[14]||(e[14]=t("h3",{class:"section-title"},"学习评分",-1)),t("div",re,[t("div",de,[s(f,{type:"dashboard",percentage:d.value.score.total,color:R(d.value.score.total),format:K,"stroke-width":15,width:150},null,8,["percentage","color"])]),t("div",ue,[t("div",ce,[e[11]||(e[11]=t("span",{class:"score-label"},"打卡频率",-1)),s(f,{percentage:d.value.score.frequency,color:R(d.value.score.frequency)},null,8,["percentage","color"])]),t("div",pe,[e[12]||(e[12]=t("span",{class:"score-label"},"学习时长",-1)),s(f,{percentage:d.value.score.duration,color:R(d.value.score.duration)},null,8,["percentage","color"])]),t("div",_e,[e[13]||(e[13]=t("span",{class:"score-label"},"学习稳定性",-1)),s(f,{percentage:d.value.score.stability,color:R(d.value.score.stability)},null,8,["percentage","color"])])])])]),t("div",me,[e[18]||(e[18]=t("h3",{class:"section-title"},"学习总结",-1)),s(r,{"body-style":{padding:"20px"},class:"summary-card"},{default:l(()=>[t("div",ve,[e[15]||(e[15]=t("span",{class:"summary-label"},"打卡频率：",-1)),t("span",ye,m(d.value.summary.checkin_frequency),1)]),t("div",ge,[e[16]||(e[16]=t("span",{class:"summary-label"},"学习趋势：",-1)),t("span",fe,m(d.value.summary.learning_trend),1)]),t("div",he,[e[17]||(e[17]=t("span",{class:"summary-label"},"稳定性：",-1)),t("span",ke,m(d.value.summary.stability_level),1)])]),_:1})]),t("div",be,[t("div",we,[e[19]||(e[19]=t("h3",{class:"section-title"},"存在问题",-1)),s(r,{"body-style":{padding:"20px"},class:"issues-card"},{default:l(()=>[d.value.issues&&d.value.issues.length>0?(i(),u("ul",Ve,[(i(!0),u(q,null,B(d.value.issues,(a,k)=>(i(),u("li",{key:k,class:"issue-item"},m(a),1))),128))])):(i(),u("p",Ae,"暂无问题"))]),_:1})]),t("div",Ie,[e[20]||(e[20]=t("h3",{class:"section-title"},"改进建议",-1)),s(r,{"body-style":{padding:"20px"},class:"suggestions-card"},{default:l(()=>[d.value.suggestions&&d.value.suggestions.length>0?(i(),u("ul",Ce,[(i(!0),u(q,null,B(d.value.suggestions,(a,k)=>(i(),u("li",{key:k,class:"suggestion-item"},m(a),1))),128))])):(i(),u("p",Se,"暂无建议"))]),_:1})])]),t("div",xe,[e[22]||(e[22]=t("h3",{class:"section-title"},"推荐学习时长",-1)),s(r,{"body-style":{padding:"20px"},class:"recommended-card"},{default:l(()=>[t("div",De,[e[21]||(e[21]=t("span",{class:"hours-label"},"建议每日学习时长：",-1)),t("span",Te,m(d.value.recommended_hours)+" 小时",1)])]),_:1})])])):(i(),u("div",Re,[s(U,{description:"点击生成报告"})])),S.value?(i(),W(V,{key:2,type:"error",title:S.value,"show-icon":"",class:"error-alert"},null,8,["title"])):I("",!0)]),_:1})]),t("div",Ue,[s(r,{"body-style":{padding:"30px"}},{default:l(()=>[e[25]||(e[25]=t("h2",{class:"card-title"},"AI学习教练",-1)),t("div",Pe,[s(h,{"label-width":"120px",class:"data-form"},{default:l(()=>[s(n,{label:"学习目标"},{default:l(()=>[s(Q,{modelValue:v.value.learning_goal,"onUpdate:modelValue":e[1]||(e[1]=a=>v.value.learning_goal=a),placeholder:"例如：考研数学"},null,8,["modelValue"])]),_:1}),s(n,{label:"本周总学习时长"},{default:l(()=>[s(A,{modelValue:v.value.weekly_total_hours,"onUpdate:modelValue":e[2]||(e[2]=a=>v.value.weekly_total_hours=a),min:0,step:.5,placeholder:"小时"},null,8,["modelValue"])]),_:1}),s(n,{label:"平均每日学习时长"},{default:l(()=>[s(A,{modelValue:v.value.average_daily_hours,"onUpdate:modelValue":e[3]||(e[3]=a=>v.value.average_daily_hours=a),min:0,step:.5,placeholder:"小时"},null,8,["modelValue"])]),_:1}),s(n,{label:"目标每日学习时长"},{default:l(()=>[s(A,{modelValue:v.value.target_daily_hours,"onUpdate:modelValue":e[4]||(e[4]=a=>v.value.target_daily_hours=a),min:0,step:.5,placeholder:"小时"},null,8,["modelValue"])]),_:1}),s(n,{label:"连续打卡天数"},{default:l(()=>[s(A,{modelValue:v.value.consecutive_checkin_days,"onUpdate:modelValue":e[5]||(e[5]=a=>v.value.consecutive_checkin_days=a),min:0,step:1,placeholder:"天"},null,8,["modelValue"])]),_:1}),s(n,{label:"漏打卡天数"},{default:l(()=>[s(A,{modelValue:v.value.missed_checkin_days,"onUpdate:modelValue":e[6]||(e[6]=a=>v.value.missed_checkin_days=a),min:0,step:1,placeholder:"天"},null,8,["modelValue"])]),_:1}),s(n,null,{default:l(()=>[s(_,{type:"primary",onClick:z,loading:O.value},{default:l(()=>[...e[24]||(e[24]=[w(" 获取学习指导 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),N.value?(i(),u("div",Le,[s(r,{"body-style":{padding:"20px"},class:"response-card"},{default:l(()=>[t("div",{innerHTML:N.value,class:"ai-content"},null,8,Ee)]),_:1})])):x.value?(i(),u("div",qe,[s(V,{type:"error",title:x.value,"show-icon":"",class:"error-alert"},null,8,["title"])])):I("",!0)]),_:1})]),t("div",Be,[s(r,{"body-style":{padding:"30px"}},{default:l(()=>[e[37]||(e[37]=t("h2",{class:"card-title"},"AI打卡分析",-1)),s(V,{title:"使用说明",description:"选择分析日期范围，系统将自动分析您的打卡记录，识别学习模式和异常情况，并提供个性化的改进建议。",type:"info","show-icon":"",style:{"margin-bottom":"20px"}}),t("div",Fe,[s(h,{inline:!0,class:"analysis-form"},{default:l(()=>[s(n,{label:"开始日期"},{default:l(()=>[s(p,{modelValue:D.value,"onUpdate:modelValue":e[7]||(e[7]=a=>D.value=a),type:"date",placeholder:"选择开始日期"},null,8,["modelValue"])]),_:1}),s(n,{label:"结束日期"},{default:l(()=>[s(p,{modelValue:T.value,"onUpdate:modelValue":e[8]||(e[8]=a=>T.value=a),type:"date",placeholder:"选择结束日期"},null,8,["modelValue"])]),_:1}),s(n,{label:"分析类型"},{default:l(()=>[s(X,{modelValue:$.value,"onUpdate:modelValue":e[9]||(e[9]=a=>$.value=a),placeholder:"选择分析类型"},{default:l(()=>[s(H,{label:"综合分析",value:"comprehensive"}),s(H,{label:"规律分析",value:"pattern"}),s(H,{label:"异常分析",value:"anomaly"})]),_:1},8,["modelValue"])]),_:1}),s(n,null,{default:l(()=>[s(_,{type:"primary",onClick:G,loading:M.value},{default:l(()=>[...e[26]||(e[26]=[w(" 开始分析 ",-1)])]),_:1},8,["loading"])]),_:1}),s(n,null,{default:l(()=>[s(_,{type:"info",onClick:J},{default:l(()=>[...e[27]||(e[27]=[w(" 测试连接 ",-1)])]),_:1})]),_:1})]),_:1})]),y.value?(i(),u("div",Ne,[y.value.stats.total_checkins===0?(i(),W(V,{key:0,title:"暂无打卡数据",description:"您选择的日期范围内没有打卡记录，请调整日期范围或开始打卡后再进行分析。",type:"info","show-icon":"",style:{"margin-bottom":"20px"}})):I("",!0),t("div",Oe,[e[32]||(e[32]=t("h3",{class:"section-title"},"打卡统计概览",-1)),s(Y,{gutter:20},{default:l(()=>[s(P,{span:6},{default:l(()=>[s(r,{class:"stat-card"},{default:l(()=>[t("div",$e,m(y.value.stats.total_checkins),1),e[28]||(e[28]=t("div",{class:"stat-label"},"总打卡次数",-1))]),_:1})]),_:1}),s(P,{span:6},{default:l(()=>[s(r,{class:"stat-card"},{default:l(()=>[t("div",Me,m(y.value.stats.total_hours.toFixed(1)),1),e[29]||(e[29]=t("div",{class:"stat-label"},"总学习时长（小时）",-1))]),_:1})]),_:1}),s(P,{span:6},{default:l(()=>[s(r,{class:"stat-card"},{default:l(()=>[t("div",je,m(y.value.stats.checkin_rate.toFixed(1))+"%",1),e[30]||(e[30]=t("div",{class:"stat-label"},"打卡率",-1))]),_:1})]),_:1}),s(P,{span:6},{default:l(()=>[s(r,{class:"stat-card"},{default:l(()=>[t("div",He,m(y.value.stats.streak_days),1),e[31]||(e[31]=t("div",{class:"stat-label"},"最长连续打卡（天）",-1))]),_:1})]),_:1})]),_:1})]),t("div",We,[e[33]||(e[33]=t("h3",{class:"section-title"},"AI洞察",-1)),s(r,{class:"insights-card"},{default:l(()=>[(i(!0),u(q,null,B(y.value.insights,(a,k)=>(i(),u("div",{key:k,class:"insight-item"},m(a),1))),128))]),_:1})]),t("div",ze,[e[34]||(e[34]=t("h3",{class:"section-title"},"改进建议",-1)),s(r,{class:"recommendations-card"},{default:l(()=>[(i(!0),u(q,null,B(y.value.recommendations,(a,k)=>(i(),u("div",{key:k,class:"recommendation-item"},m(a),1))),128))]),_:1})]),y.value.anomalies&&y.value.anomalies.length>0?(i(),u("div",Je,[e[35]||(e[35]=t("h3",{class:"section-title"},"异常打卡情况",-1)),s(r,{class:"anomalies-card"},{default:l(()=>[s(ee,{data:y.value.anomalies,style:{width:"100%"}},{default:l(()=>[s(L,{prop:"date",label:"日期",width:"120"},{default:l(a=>[w(m(new Date(a.row.date).toLocaleDateString()),1)]),_:1}),s(L,{prop:"type",label:"异常类型",width:"120"}),s(L,{prop:"description",label:"描述"}),s(L,{prop:"severity",label:"严重程度",width:"100"},{default:l(a=>[s(Z,{type:a.row.severity==="high"?"danger":"warning"},{default:l(()=>[w(m(a.row.severity==="high"?"高":"中"),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]),_:1})])):I("",!0),t("div",Ge,[e[36]||(e[36]=t("h3",{class:"section-title"},"AI总结",-1)),s(r,{class:"summary-card"},{default:l(()=>[t("div",Ke,m(y.value.ai_summary),1)]),_:1})])])):b.value?(i(),u("div",Qe,[s(V,{type:"error",title:b.value,"show-icon":"",class:"error-alert"},null,8,["title"])])):I("",!0)]),_:1})])])}}},es=se(Xe,[["__scopeId","data-v-6a80730a"]]);export{es as default};

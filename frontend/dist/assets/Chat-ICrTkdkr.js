import{_ as J,u as Q,f as r,j as W,o as l,c,a as t,b as e,w as n,t as i,e as L,F as V,n as x,J as X,p as Y,q as Z,g as $,m as ee,l as te,r as o,s as z,v as se,h as u,K as ae,L as ne,M as oe,N as le}from"./index-D_A4Kxuy.js";const ce={class:"chat-container"},ie={class:"chat-header"},de={class:"page-title"},re={class:"header-actions"},ue={class:"chat-content"},_e={key:0,class:"checkin-section"},me={class:"card-header"},he={key:0},pe={class:"checkin-list"},ve={class:"checkin-info"},ke={class:"member-name"},fe={class:"checkin-details"},ge={class:"checkin-time"},ye={class:"checkin-list"},we={class:"checkin-info"},Ce={class:"member-name"},be={key:1,class:"no-checkins"},Ve={class:"messages-section"},xe={key:0,class:"no-messages"},ze={class:"message-avatar"},De={class:"message-content"},Ne={class:"message-header"},Me={class:"message-sender"},Ae={class:"message-time"},Te={class:"message-body"},Be={class:"message-input-section"},Ke={class:"input-actions"},Se={__name:"Chat",setup(Ue){const D=$(),N=Z(),v=Q(),M=r(N.params.id),O=r(N.query.name||"群聊"),k=r(!0),g=r(new Date),A=r("checked_in"),m=r(""),f=r(null),h=r({checked_in:[],not_checked_in:[]}),y=r([{id:1,sender:"系统",content:"欢迎来到群聊！在这里可以查看群组成员的打卡情况，也可以发送消息互相鼓励学习。",timestamp:new Date,isOwn:!1}]),q=()=>{D.back()},E=()=>{k.value=!0},F=()=>{k.value=!k.value},w=async()=>{if(M.value)try{const d=await ee.groups.getGroupCheckins(M.value,{date:g.value});h.value={checked_in:d.data.data.checked_in||[],not_checked_in:d.data.data.not_checked_in||[]}}catch(d){console.error("获取群组打卡情况失败:",d),te.error("获取群组打卡情况失败")}},T=()=>{var s;if(!m.value.trim())return;const d={id:Date.now(),sender:((s=v.user)==null?void 0:s.username)||"我",content:m.value.trim(),timestamp:new Date,isOwn:!0};y.value.push(d),m.value="",le(()=>{f.value&&(f.value.scrollTop=f.value.scrollHeight)})},B=d=>d?new Date(d).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"";return W(async()=>{if(!v.isAuthenticated){D.push("/auth/login");return}v.user||await v.fetchUserInfo(),await w()}),(d,s)=>{const C=o("el-icon"),p=o("el-button"),G=o("el-date-picker"),K=o("el-form-item"),P=o("el-form"),b=o("el-avatar"),S=o("el-tag"),U=o("el-tab-pane"),R=o("el-tabs"),I=o("el-empty"),j=o("el-card"),H=o("el-input");return l(),c("div",ce,[t("div",ie,[e(p,{type:"text",onClick:q,class:"back-button"},{default:n(()=>[e(C,null,{default:n(()=>[e(z(se))]),_:1}),s[3]||(s[3]=u(" 返回 ",-1))]),_:1}),t("h1",de,i(O.value)+" - 群聊",1),t("div",re,[e(p,{type:"text",onClick:E},{default:n(()=>[e(C,null,{default:n(()=>[e(z(ae))]),_:1}),s[4]||(s[4]=u(" 打卡统计 ",-1))]),_:1})])]),t("div",ue,[k.value?(l(),c("div",_e,[e(j,{class:"checkin-card"},{header:n(()=>[t("div",me,[s[5]||(s[5]=t("span",null,"今日打卡情况",-1)),e(p,{type:"text",onClick:F},{default:n(()=>[e(C,null,{default:n(()=>[e(z(ne))]),_:1})]),_:1})])]),default:n(()=>[e(P,{inline:!0,class:"date-form"},{default:n(()=>[e(K,{label:"选择日期"},{default:n(()=>[e(G,{modelValue:g.value,"onUpdate:modelValue":s[0]||(s[0]=a=>g.value=a),type:"date",placeholder:"选择日期",onChange:w,size:"small"},null,8,["modelValue"])]),_:1}),e(K,null,{default:n(()=>[e(p,{type:"primary",onClick:w,size:"small"},{default:n(()=>[...s[6]||(s[6]=[u(" 查询 ",-1)])]),_:1})]),_:1})]),_:1}),h.value.checked_in.length>0||h.value.not_checked_in.length>0?(l(),c("div",he,[e(R,{modelValue:A.value,"onUpdate:modelValue":s[1]||(s[1]=a=>A.value=a),class:"checkin-tabs"},{default:n(()=>[e(U,{label:"已打卡",name:"checked_in"},{default:n(()=>[t("div",pe,[(l(!0),c(V,null,x(h.value.checked_in,a=>(l(),c("div",{key:a.user_id,class:"checkin-item"},[e(b,{size:32,class:"member-avatar"},{default:n(()=>{var _;return[u(i(((_=a.username)==null?void 0:_.charAt(0))||"用"),1)]}),_:2},1024),t("div",ve,[t("div",ke,i(a.username),1),t("div",fe,[e(S,{size:"small",type:"success"},{default:n(()=>[u(" 学习 "+i(a.hours)+" 小时 ",1)]),_:2},1024),t("span",ge,i(B(a.checkin_time)),1)])])]))),128))])]),_:1}),e(U,{label:"未打卡",name:"not_checked_in"},{default:n(()=>[t("div",ye,[(l(!0),c(V,null,x(h.value.not_checked_in,a=>(l(),c("div",{key:a.user_id,class:"checkin-item not-checked"},[e(b,{size:32,class:"member-avatar"},{default:n(()=>{var _;return[u(i(((_=a.username)==null?void 0:_.charAt(0))||"用"),1)]}),_:2},1024),t("div",we,[t("div",Ce,i(a.username),1),e(S,{size:"small",type:"info"},{default:n(()=>[...s[7]||(s[7]=[u("未打卡",-1)])]),_:1})])]))),128))])]),_:1})]),_:1},8,["modelValue"])])):(l(),c("div",be,[e(I,{description:"暂无打卡数据"})]))]),_:1})])):L("",!0),t("div",Ve,[t("div",{class:"messages-container",ref_key:"messagesContainer",ref:f},[y.value.length===0?(l(),c("div",xe,[e(I,{description:"暂无消息"})])):L("",!0),(l(!0),c(V,null,x(y.value,a=>(l(),c("div",{key:a.id,class:oe(["message-item",{"own-message":a.isOwn}])},[t("div",ze,[e(b,{size:36},{default:n(()=>{var _;return[u(i(((_=a.sender)==null?void 0:_.charAt(0))||"用"),1)]}),_:2},1024)]),t("div",De,[t("div",Ne,[t("span",Me,i(a.sender),1),t("span",Ae,i(B(a.timestamp)),1)]),t("div",Te,i(a.content),1)])],2))),128))],512)]),t("div",Be,[e(H,{modelValue:m.value,"onUpdate:modelValue":s[2]||(s[2]=a=>m.value=a),type:"textarea",placeholder:"输入消息...",rows:2,onKeyup:X(Y(T,["prevent"]),["enter"]),class:"message-input"},null,8,["modelValue","onKeyup"]),t("div",Ke,[e(p,{type:"primary",onClick:T,disabled:!m.value.trim()},{default:n(()=>[...s[8]||(s[8]=[u(" 发送 ",-1)])]),_:1},8,["disabled"])])])])])}}},Le=J(Se,[["__scopeId","data-v-94b13ad5"]]);export{Le as default};

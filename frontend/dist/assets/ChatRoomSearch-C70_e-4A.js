import{_ as _e,j as ve,o as c,c as g,a as d,b as l,w as t,p as fe,D as ge,e as z,m as C,l as y,f as p,r as i,C as he,i as B,g as ye,s as J,H as be,h as m,A as we,F as E,n as H,d as L,t as _,I as Ve}from"./index-D_A4Kxuy.js";const Ce={class:"chat-room-search"},ke={class:"search-header"},xe={class:"search-form"},Re={class:"search-results"},Ue={key:0,class:"no-results"},De={key:1},Ie={class:"room-header"},ze={class:"room-avatar"},Fe={class:"room-info"},$e={class:"room-name"},Se={class:"room-id"},je={key:0,class:"room-description"},Ae={class:"room-stats"},Be={class:"member-count"},Je={class:"room-actions"},Le={key:0,class:"pagination"},Me={key:0,class:"join-room-info"},Ne={class:"room-header"},qe={class:"room-info"},T="https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",M=20,Ge={__name:"ChatRoomSearch",setup(Pe){const K=ye(),v=B({chatId:"",keyword:""}),b=p([]),I=p(!1),w=p(0),k=p(1),x=p(!1),F=p(!1),R=p(),$=p([]),n=B({name:"",description:"",avatar_url:"",max_members:500,is_public:!0,group_id:null}),O={name:[{required:!0,message:"请输入群聊名称",trigger:"blur"},{min:1,max:100,message:"群聊名称长度不能超过100个字符",trigger:"blur"}]},U=p(!1),S=p(!1),h=p(null),D=B({message:""}),j=o=>{if(!o||o.length<=4)return o;let e="";for(let r=0;r<o.length;r++)r>0&&r%3===0&&(e+="-"),e+=o[r];return e},V=async()=>{var o,e,r;I.value=!0;try{const s={page:k.value,page_size:M};if(v.chatId)try{const u=await C.chatRooms.searchByChatId(v.chatId);b.value=[u.data],w.value=1}catch(u){if(((o=u.response)==null?void 0:o.status)===404)b.value=[],w.value=0,y.warning("未找到该群聊ID");else throw u}else if(v.keyword){s.keyword=v.keyword;const u=await C.chatRooms.searchChatRooms(s);b.value=u.data.chat_rooms,w.value=u.data.total}else{const u=await C.chatRooms.searchChatRooms(s);b.value=u.data.chat_rooms,w.value=u.data.total}}catch(s){y.error("搜索失败："+(((r=(e=s.response)==null?void 0:e.data)==null?void 0:r.detail)||s.message))}finally{I.value=!1}},Q=()=>{v.chatId="",v.keyword="",k.value=1,V()},W=o=>{k.value=o,V()},X=async()=>{try{const o=await C.groups.getGroups();$.value=[...o.data.created.map(e=>({...e,isCreated:!0})),...o.data.joined.map(e=>({...e,isJoined:!0}))]}catch(o){console.error("获取用户群组失败:",o)}},Y=async()=>{R.value&&await R.value.validate(async o=>{var e,r;if(o){F.value=!0;try{const s=await C.chatRooms.createChatRoom(n);y.success("群聊创建成功！"),y.info(`群聊ID: ${j(s.data.chat_id)}`),x.value=!1,N(),V()}catch(s){y.error("创建失败："+(((r=(e=s.response)==null?void 0:e.data)==null?void 0:r.detail)||s.message))}finally{F.value=!1}}})},N=()=>{n.name="",n.description="",n.avatar_url="",n.max_members=500,n.is_public=!0,n.group_id=null,R.value&&R.value.clearValidate()},q=o=>!1,Z=o=>{h.value=o,U.value=!0},ee=async()=>{var o,e;S.value=!0;try{await C.chatRooms.createJoinRequest(h.value.chat_room_id,{message:D.message}),y.success("加入申请已发送，请等待审批"),U.value=!1,D.message=""}catch(r){y.error("申请失败："+(((e=(o=r.response)==null?void 0:o.data)==null?void 0:e.detail)||r.message))}finally{S.value=!1}},ae=o=>{K.push(`/chat-rooms/${o.chat_room_id}`)};return ve(async()=>{await X(),V()}),(o,e)=>{const r=i("el-icon"),s=i("el-button"),u=i("el-input"),f=i("el-form-item"),A=i("el-form"),le=i("el-empty"),G=i("el-avatar"),te=i("el-tag"),oe=i("el-card"),se=i("el-col"),ne=i("el-row"),re=i("el-pagination"),ue=i("el-input-number"),de=i("el-switch"),ie=i("el-option"),me=i("el-select"),P=i("el-dialog"),ce=he("loading");return c(),g("div",Ce,[d("div",ke,[e[16]||(e[16]=d("h2",null,"搜索群聊",-1)),l(s,{type:"primary",onClick:e[0]||(e[0]=a=>x.value=!0)},{default:t(()=>[l(r,null,{default:t(()=>[l(J(be))]),_:1}),e[15]||(e[15]=m(" 创建群聊 ",-1))]),_:1})]),d("div",xe,[l(A,{inline:!0,onSubmit:fe(V,["prevent"])},{default:t(()=>[l(f,{label:"群聊ID"},{default:t(()=>[l(u,{modelValue:v.chatId,"onUpdate:modelValue":e[1]||(e[1]=a=>v.chatId=a),placeholder:"输入6-8位群聊ID",maxlength:"8",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),l(f,{label:"关键词"},{default:t(()=>[l(u,{modelValue:v.keyword,"onUpdate:modelValue":e[2]||(e[2]=a=>v.keyword=a),placeholder:"群聊名称或描述",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),l(f,null,{default:t(()=>[l(s,{type:"primary",onClick:V,loading:I.value},{default:t(()=>[l(r,null,{default:t(()=>[l(J(we))]),_:1}),e[17]||(e[17]=m(" 搜索 ",-1))]),_:1},8,["loading"]),l(s,{onClick:Q},{default:t(()=>[...e[18]||(e[18]=[m("重置",-1)])]),_:1})]),_:1})]),_:1})]),ge((c(),g("div",Re,[b.value.length===0?(c(),g("div",Ue,[l(le,{description:"暂无搜索结果"})])):(c(),g("div",De,[l(ne,{gutter:20},{default:t(()=>[(c(!0),g(E,null,H(b.value,a=>(c(),L(se,{xs:24,sm:12,md:8,lg:6,key:a.chat_room_id},{default:t(()=>[l(oe,{class:"chat-room-card",shadow:"hover"},{default:t(()=>[d("div",Ie,[d("div",ze,[l(G,{size:50,src:a.avatar_url||T},{default:t(()=>[m(_(a.name.charAt(0)),1)]),_:2},1032,["src"])]),d("div",Fe,[d("h3",$e,_(a.name),1),d("p",Se,"ID: "+_(j(a.chat_id)),1)])]),a.description?(c(),g("p",je,_(a.description),1)):z("",!0),d("div",Ae,[d("span",Be,[l(r,null,{default:t(()=>[l(J(Ve))]),_:1}),m(" "+_(a.current_members)+"/"+_(a.max_members),1)]),l(te,{size:"small",type:a.is_public?"success":"warning"},{default:t(()=>[m(_(a.is_public?"公开":"私密"),1)]),_:2},1032,["type"])]),d("div",Je,[l(s,{type:"primary",size:"small",onClick:pe=>Z(a),disabled:q(a)},{default:t(()=>[m(_(q(a)?"已加入":"加入群聊"),1)]),_:2},1032,["onClick","disabled"]),l(s,{size:"small",onClick:pe=>ae(a)},{default:t(()=>[...e[19]||(e[19]=[m(" 查看详情 ",-1)])]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1}),w.value>M?(c(),g("div",Le,[l(re,{"current-page":k.value,"onUpdate:currentPage":e[3]||(e[3]=a=>k.value=a),"page-size":M,total:w.value,layout:"prev, pager, next",onCurrentChange:W},null,8,["current-page","total"])])):z("",!0)]))])),[[ce,I.value]]),l(P,{modelValue:x.value,"onUpdate:modelValue":e[11]||(e[11]=a=>x.value=a),title:"创建群聊",width:"500px",onClose:N},{footer:t(()=>[l(s,{onClick:e[10]||(e[10]=a=>x.value=!1)},{default:t(()=>[...e[22]||(e[22]=[m("取消",-1)])]),_:1}),l(s,{type:"primary",onClick:Y,loading:F.value},{default:t(()=>[...e[23]||(e[23]=[m(" 创建 ",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(A,{model:n,rules:O,ref_key:"createFormRef",ref:R,"label-width":"80px"},{default:t(()=>[l(f,{label:"群聊名称",prop:"name"},{default:t(()=>[l(u,{modelValue:n.name,"onUpdate:modelValue":e[4]||(e[4]=a=>n.name=a),placeholder:"请输入群聊名称",maxlength:"100"},null,8,["modelValue"])]),_:1}),l(f,{label:"群聊描述",prop:"description"},{default:t(()=>[l(u,{modelValue:n.description,"onUpdate:modelValue":e[5]||(e[5]=a=>n.description=a),type:"textarea",placeholder:"请输入群聊描述（可选）",maxlength:"500",rows:3},null,8,["modelValue"])]),_:1}),l(f,{label:"群聊头像",prop:"avatar_url"},{default:t(()=>[l(u,{modelValue:n.avatar_url,"onUpdate:modelValue":e[6]||(e[6]=a=>n.avatar_url=a),placeholder:"头像URL（可选）"},null,8,["modelValue"])]),_:1}),l(f,{label:"最大成员数",prop:"max_members"},{default:t(()=>[l(ue,{modelValue:n.max_members,"onUpdate:modelValue":e[7]||(e[7]=a=>n.max_members=a),min:10,max:1e3,step:10},null,8,["modelValue"])]),_:1}),l(f,{label:"是否公开",prop:"is_public"},{default:t(()=>[l(de,{modelValue:n.is_public,"onUpdate:modelValue":e[8]||(e[8]=a=>n.is_public=a)},null,8,["modelValue"]),e[20]||(e[20]=d("span",{class:"form-tip"},"公开群聊可被搜索到",-1))]),_:1}),$.value.length>0?(c(),L(f,{key:0,label:"关联群组",prop:"group_id"},{default:t(()=>[l(me,{modelValue:n.group_id,"onUpdate:modelValue":e[9]||(e[9]=a=>n.group_id=a),placeholder:"选择关联的学习群组（可选）"},{default:t(()=>[(c(!0),g(E,null,H($.value,a=>(c(),L(ie,{key:a.group_id,label:a.name,value:a.group_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e[21]||(e[21]=d("div",{class:"form-tip"},"关联后可同步群组成员",-1))]),_:1})):z("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(P,{modelValue:U.value,"onUpdate:modelValue":e[14]||(e[14]=a=>U.value=a),title:"加入群聊",width:"400px"},{footer:t(()=>[l(s,{onClick:e[13]||(e[13]=a=>U.value=!1)},{default:t(()=>[...e[24]||(e[24]=[m("取消",-1)])]),_:1}),l(s,{type:"primary",onClick:ee,loading:S.value},{default:t(()=>[...e[25]||(e[25]=[m(" 发送申请 ",-1)])]),_:1},8,["loading"])]),default:t(()=>[h.value?(c(),g("div",Me,[d("div",Ne,[l(G,{size:40,src:h.value.avatar_url||T},{default:t(()=>[m(_(h.value.name.charAt(0)),1)]),_:1},8,["src"]),d("div",qe,[d("h3",null,_(h.value.name),1),d("p",null,"ID: "+_(j(h.value.chat_id)),1)])]),l(A,{model:D,"label-width":"80px"},{default:t(()=>[l(f,{label:"申请理由",prop:"message"},{default:t(()=>[l(u,{modelValue:D.message,"onUpdate:modelValue":e[12]||(e[12]=a=>D.message=a),type:"textarea",placeholder:"请输入申请加入的理由（可选）",maxlength:"500",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])):z("",!0)]),_:1},8,["modelValue"])])}}},He=_e(Ge,[["__scopeId","data-v-b6fbd6b2"]]);export{He as default};
